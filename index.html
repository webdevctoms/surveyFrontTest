<!DOCTYPE html>
<html>
<head>
	<title>test</title>
	<script
  src="https://code.jquery.com/jquery-1.11.3.min.js"
  integrity="sha256-7LkWEzqTdpEfELxcZZlS6wAx5Ff13zZ83lYO2/ujj7g="
  crossorigin="anonymous"></script>
</head>
<body>
	<form>
		<label class="jsQuestion" for="answer1">Question 1</label>
		<input type="number" id="answer1" class="jsAnswer"/>
		<label class="jsQuestion" for="answer2">Question 2</label>
		<input type="text" id="answer2" class="jsAnswer"/>
		<label class="jsQuestion" for="answer3">Question 3</label>
		<select id="answer3" class="jsAnswerSelect">
			<option value="1">Choice 1</option>
			<option value="2">Choice 2</option>
			<option value="3">Choice 3</option>
		</select>
		<label for="email">Email</label>
		<input type="email" name="email" id="email" class="jsEmail"/>
		<input style="width:0;height: 0;" type="checkbox" id="jsCheck"/>
		<div class="jsSuccess"></div>
		<div class="jsError"></div>
		<button class="jsSubmit">Submit</button>
	</form>
	<script type="text/javascript">
		function submitSuccess(data){
			console.log("success");
			$(".jsSuccess").append("<p style='color:green;'>Data Sent</p>");
		}

		function submitError(err){
			console.log("error");
			$(".jsError").append("<p style='color:red;'>An Error Occured</p>");
		}

		function clearMessages(){
			$(".jsSuccess").empty();
			$(".jsError").empty();
		}

		function submitClicked(){
			$(".jsSubmit").click(function(event){
				event.preventDefault();
				clearMessages();
				let questionsArr = [];
				let answersArr = [];

				$(".jsQuestion").each(function(index){
					//console.log($(this).text());
					questionsArr.push($(this).text());
				});
				$(".jsAnswer").each(function(index){
					//console.log($(this).val());
					answersArr.push($(this).val());
				});
				answersArr.push($(".jsAnswerSelect").val());
				const check = $("#jsCheck").prop('checked');
				console.log(check);
				
				const email = $('.jsEmail').val();
				console.log(email);
				console.log("submit pressed");
				let surveyData = {
					questions: questionsArr,
					answers:answersArr,
					email:email
				}
				if(check){
					console.log("checked");
					submitSuccess();
					return 0;
				}

				const settings = {
					method: "POST",
					contentType: 'application/json',
					url:"https://ctomssurvey.herokuapp.com/api/survey",
					data:JSON.stringify(surveyData),
					dataType: 'json',
					success: submitSuccess,
					error: submitError
				};

				$.ajax(settings);
			});
		}

		function initPage(){
			submitClicked();
		}
		$(initPage);
	</script>
</body>
</html>